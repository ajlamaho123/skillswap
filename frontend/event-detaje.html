<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Event Details | SkillSwap</title>
  <link rel="stylesheet" href="css/style.css">
</head>
<body>

  <!-- NAVBAR -->
  <nav class="navbar">
    <div class="logo">SkillSwap</div>
    <div class="nav-links">
      <a href="index.html">Home</a>
      <a href="index.html#featured">Events</a>
      <a href="dashboard.html">Dashboard</a>
    </div>
  </nav>

  <!-- EVENT DETAILS -->
  <section class="event-details">
    <div id="eventContainer" class="glass-card" style="max-width:700px; margin:auto;">
      <!-- Event data injected here -->
    </div>
  </section>

  <!-- SCRIPT -->
  <script>
    const params = new URLSearchParams(window.location.search);
    const eventId = params.get("id");

    const events = JSON.parse(localStorage.getItem("skillswapEvents")) || [];
    const loggedUser = JSON.parse(localStorage.getItem("loggedUser"));

    const event = events.find(e => e.id == eventId);
    const container = document.getElementById("eventContainer");

    if (!event) {
      container.innerHTML = "<h3>Event not found</h3>";
      throw new Error("Event not found");
    }

    const isJoined =
      loggedUser &&
      event.joinedUsers &&
      event.joinedUsers.includes(loggedUser.email);

    const isFull = event.participants >= event.limit;

    container.innerHTML = `
      <h2>${event.title}</h2>
      <p><strong>Skill:</strong> ${event.skill}</p>
      <p><strong>Level:</strong> ${event.level}</p>
      <p><strong>Host:</strong> ${event.hostName || "Verified Host"}</p>
      <p><strong>Description:</strong></p>
      <p>${event.description || "No description provided."}</p>

      <hr>

      <p>üë• Participants: ${event.participants} / ${event.limit}</p>

      <div id="actionArea" style="margin-top:20px;"></div>
    `;

    const actionArea = document.getElementById("actionArea");

    // USER NOT LOGGED IN
    if (!loggedUser) {
      actionArea.innerHTML = `
        <p>You must be logged in to join this event.</p>
        <a href="login.html" class="btn">Login to Join</a>
      `;
    }

    // USER ALREADY JOINED
    else if (isJoined) {
      actionArea.innerHTML = `
        <p style="color:green;">‚úî You have already joined this event.</p>
      `;
    }

    // EVENT FULL
    else if (isFull) {
      actionArea.innerHTML = `
        <p style="color:red;">‚ùå This event is full.</p>
      `;
    }

    // USER CAN JOIN
    else {
      actionArea.innerHTML = `
        <button class="btn" onclick="joinEvent()">Join Event</button>
      `;
    }

    function joinEvent() {
      event.participants++;

      if (!event.joinedUsers) {
        event.joinedUsers = [];
      }

      event.joinedUsers.push(loggedUser.email);

      localStorage.setItem("skillswapEvents", JSON.stringify(events));
      location.reload();
    }
  </script>

</body>
</html>
